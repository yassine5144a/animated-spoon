<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Network - شبكتك الاجتماعية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
        }

        .dark-mode {
            --bg-color: #1a202c;
            --card-bg: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            direction: rtl;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* شاشة تسجيل الدخول */
        .auth-container {
            display: flex;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }

        .auth-box {
            background: var(--card-bg);
            margin: auto;
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 450px;
            backdrop-filter: blur(10px);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .auth-title {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-input {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-input.error {
            border-color: var(--danger);
        }

        .password-strength {
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: 2px;
        }

        .strength-weak { background: var(--danger); width: 33%; }
        .strength-medium { background: var(--warning); width: 66%; }
        .strength-strong { background: var(--success); width: 100%; }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--accent);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .auth-switch {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-secondary);
        }

        .auth-link {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
        }

        .error-message {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1rem;
            border: 1px solid rgba(247, 37, 133, 0.2);
        }

        .success-message {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1rem;
            border: 1px solid rgba(76, 201, 240, 0.2);
        }

        /* التطبيق الرئيسي */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* الهيدر */
        .header {
            background: var(--card-bg);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-nav {
            display: flex;
            gap: 1.5rem;
        }

        .nav-item {
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(0,0,0,0.05);
            color: var(--text-primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .user-menu:hover {
            background: rgba(0,0,0,0.05);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* المحتوى الرئيسي */
        .main-content {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 2rem;
            flex: 1;
        }

        /* الشريط الجانبي */
        .sidebar {
            width: 280px;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-radius: 10px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sidebar-item:hover {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .sidebar-item.active {
            background: var(--primary);
            color: white;
        }

        /* منطقة المحتوى */
        .content-area {
            flex: 1;
        }

        .page {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .page-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
        }

        /* صفحة الرئيسية */
        .create-post {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .post-input {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            overflow: hidden;
        }

        .post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-editor {
            flex: 1;
        }

        .post-textarea {
            width: 100%;
            border: none;
            outline: none;
            font-size: 1.1rem;
            resize: none;
            background: transparent;
            color: var(--text-primary);
            min-height: 60px;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
        }

        .post-options {
            display: flex;
            gap: 1rem;
        }

        .post-option {
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .post-option:hover {
            background: rgba(0,0,0,0.05);
            color: var(--primary);
        }

        .feed {
            padding: 0;
        }

        .post {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .post:hover {
            background: rgba(0,0,0,0.02);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .post-user {
            display: flex;
            flex-direction: column;
        }

        .post-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .post-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .post-content {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .post-image {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .post-image img {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
        }

        .post-stats {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .post-engagement {
            display: flex;
            gap: 0.5rem;
            border-top: 1px solid #e2e8f0;
            padding-top: 1rem;
        }

        .post-action {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .post-action:hover {
            background: rgba(0,0,0,0.05);
            color: var(--primary);
        }

        /* صفحة الأصدقاء */
        .friends-page {
            min-height: 600px;
        }

        .friends-search {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .search-box {
            position: relative;
        }

        .search-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .search-input {
            width: 100%;
            padding: 1rem 3rem 1rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .friends-tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
        }

        .friend-tab {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }

        .friend-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .friends-list {
            padding: 1.5rem;
        }

        .friend-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .friend-item:hover {
            background: rgba(0,0,0,0.05);
        }

        .friend-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            overflow: hidden;
        }

        .friend-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .friend-mutual {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .friend-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* صفحة الرسائل */
        .messages-page {
            height: 600px;
        }

        .messages-container {
            display: flex;
            height: 100%;
        }

        .conversations-sidebar {
            width: 350px;
            border-left: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
        }

        .conversations-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .conversations-list {
            flex: 1;
            overflow-y: auto;
        }

        .conversation-item {
            display: flex;
            padding: 1rem 1.5rem;
            cursor: pointer;
            border-bottom: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .conversation-item:hover, .conversation-item.active {
            background: rgba(67, 97, 238, 0.1);
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-left: 1rem;
            overflow: hidden;
        }

        .conversation-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .conversation-info {
            flex: 1;
        }

        .conversation-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .conversation-last-message {
            color: var(--text-secondary);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            overflow: hidden;
        }

        .chat-user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-user-info {
            flex: 1;
        }

        .chat-user-name {
            font-weight: 600;
        }

        .chat-user-status {
            color: var(--success);
            font-size: 0.8rem;
        }

        .messages-container-inner {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
        }

        .message {
            display: flex;
            margin-bottom: 1rem;
            max-width: 70%;
        }

        .message.sent {
            align-self: flex-end;
        }

        .message.received {
            align-self: flex-start;
        }

        .message-content {
            padding: 0.75rem 1rem;
            border-radius: 18px;
            position: relative;
        }

        .message.sent .message-content {
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.received .message-content {
            background: var(--card-bg);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message-text {
            margin-bottom: 0.25rem;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.8;
            text-align: left;
        }

        .message-input-area {
            display: flex;
            padding: 1rem 1.5rem;
            background: var(--card-bg);
            border-top: 1px solid #e2e8f0;
            gap: 0.5rem;
        }

        .message-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 24px;
            outline: none;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .message-input:focus {
            border-color: var(--primary);
        }

        .send-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 24px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .empty-chat {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-color);
            color: var(--text-secondary);
            text-align: center;
        }

        .empty-chat-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* صفحة الملف الشخصي */
        .profile-page {
            padding: 2rem;
        }

        .profile-header {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .profile-avatar {
            position: relative;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 3rem;
            overflow: hidden;
            border: 5px solid var(--card-bg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-edit {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .profile-bio {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .profile-stats {
            display: flex;
            gap: 2rem;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
        }

        .profile-tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }

        .profile-tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }

        .profile-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .profile-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }

        .profile-posts {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .profile-details {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .detail-item {
            margin-bottom: 1.5rem;
        }

        .detail-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .detail-value {
            color: var(--text-secondary);
        }

        /* التجاوب مع الشاشات الصغيرة */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
            }
            
            .profile-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .header-nav {
                gap: 0.5rem;
            }
            
            .nav-item span {
                display: none;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .messages-container {
                flex-direction: column;
            }
            
            .conversations-sidebar {
                width: 100%;
                height: 300px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- سيتم تحميل التطبيق هنا -->
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged, 
            updateProfile 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            where, 
            orderBy, 
            onSnapshot, 
            serverTimestamp, 
            doc, 
            getDoc, 
            setDoc, 
            updateDoc, 
            getDocs 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // تكوين Firebase الخاص بك
        const firebaseConfig = {
            apiKey: "AIzaSyC_WNvJdCRw9viU4xJfhDL_545zHK4u-kE",
            authDomain: "yassine-web-2025.firebaseapp.com",
            projectId: "yassine-web-2025",
            storageBucket: "yassine-web-2025.firebasestorage.app",
            messagingSenderId: "72261230105",
            appId: "1:72261230105:web:e056fea00afa3d8d571488",
            measurementId: "G-BG1Y78N59V"
        };

        // تهيئة Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // جعل المتغيرات متاحة globally
        window.firebase = { app, auth, db, storage };
        window.firebaseFunctions = { 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            updateProfile,
            collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp, doc, getDoc, setDoc, updateDoc, getDocs,
            ref, uploadBytes, getDownloadURL
        };
    </script>

    <script>
        class SocialApp {
            constructor() {
                this.currentUser = null;
                this.currentPage = 'home';
                this.conversations = [];
                this.messages = [];
                this.currentConversation = null;
                this.users = {};
                this.searchResults = [];
                this.isLoading = false;
                this.friends = [];
                this.friendRequests = [];
                this.suggestedFriends = [];
                this.isDarkMode = false;
                
                this.init();
            }

            async init() {
                console.log('Initializing SocialApp...');
                
                // التحقق من حالة المصادقة
                window.firebaseFunctions.onAuthStateChanged(window.firebase.auth, async (user) => {
                    console.log('Auth state changed:', user);
                    if (user) {
                        await this.loadUserData(user);
                        this.showApp();
                    } else {
                        this.showLogin();
                    }
                });

                // إعداد معالجات الأحداث
                this.setupEventListeners();
                
                // تحميل البيانات الأولية
                this.loadInitialData();
            }

            async loadUserData(user) {
                try {
                    console.log('Loading user data for:', user.uid);
                    const userDoc = await window.firebaseFunctions.getDoc(
                        window.firebaseFunctions.doc(window.firebase.db, 'users', user.uid)
                    );
                    
                    if (userDoc.exists()) {
                        this.currentUser = {
                            uid: user.uid,
                            ...userDoc.data()
                        };
                        console.log('User data loaded:', this.currentUser);
                    } else {
                        // إنشاء مستخدم جديد إذا لم يوجد
                        console.log('Creating new user document...');
                        await this.createUserDocument(user);
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    this.showError('خطأ في تحميل بيانات المستخدم');
                }
            }

            async createUserDocument(user) {
                try {
                    await window.firebaseFunctions.setDoc(
                        window.firebaseFunctions.doc(window.firebase.db, 'users', user.uid),
                        {
                            name: user.displayName || user.email.split('@')[0],
                            email: user.email,
                            bio: 'مرحباً! أنا جديد في Social',
                            createdAt: window.firebaseFunctions.serverTimestamp(),
                            friends: [],
                            friendRequests: [],
                            profilePicture: ''
                        }
                    );
                    
                    this.currentUser = {
                        uid: user.uid,
                        name: user.displayName || user.email.split('@')[0],
                        email: user.email,
                        bio: 'مرحباً! أنا جديد في Social',
                        friends: [],
                        friendRequests: [],
                        profilePicture: ''
                    };
                    console.log('User document created:', this.currentUser);
                } catch (error) {
                    console.error('Error creating user document:', error);
                    throw error;
                }
            }

            setupEventListeners() {
                // استخدام event delegation للتعامل مع الأحداث
                document.addEventListener('click', (e) => {
                    if (this.isLoading) return;

                    // تسجيل الدخول والتسجيل
                    if (e.target.classList.contains('auth-link')) {
                        this.toggleLoginSignup();
                    }
                    
                    if (e.target.classList.contains('login-btn')) {
                        this.handleLogin();
                    }
                    
                    if (e.target.classList.contains('signup-btn')) {
                        this.handleSignup();
                    }
                    
                    if (e.target.classList.contains('logout-btn')) {
                        this.handleLogout();
                    }

                    // التنقل
                    if (e.target.classList.contains('nav-item')) {
                        this.changePage(e.target.dataset.page);
                    }

                    if (e.target.classList.contains('sidebar-item')) {
                        this.changePage(e.target.dataset.page);
                    }

                    // الرسائل
                    if (e.target.classList.contains('send-button')) {
                        this.sendMessage();
                    }

                    if (e.target.classList.contains('new-conversation-btn')) {
                        this.showNewConversation();
                    }

                    if (e.target.classList.contains('back-button')) {
                        this.showConversations();
                    }

                    if (e.target.classList.contains('user-result')) {
                        this.startConversation(e.target.dataset.userId);
                    }

                    // الأصدقاء
                    if (e.target.classList.contains('friend-tab')) {
                        this.changeFriendTab(e.target.dataset.tab);
                    }

                    if (e.target.classList.contains('add-friend-btn')) {
                        this.sendFriendRequest(e.target.dataset.userId);
                    }

                    if (e.target.classList.contains('accept-friend-btn')) {
                        this.acceptFriendRequest(e.target.dataset.userId);
                    }

                    // الملف الشخصي
                    if (e.target.classList.contains('avatar-edit')) {
                        this.uploadProfilePicture();
                    }

                    if (e.target.classList.contains('profile-tab')) {
                        this.changeProfileTab(e.target.dataset.tab);
                    }

                    // الوضع الداكن
                    if (e.target.classList.contains('theme-toggle')) {
                        this.toggleDarkMode();
                    }

                    // المحادثات
                    if (e.target.closest('.conversation-item')) {
                        const item = e.target.closest('.conversation-item');
                        const conversationId = item.dataset.conversationId;
                        const userId = item.dataset.userId;
                        this.openConversation(conversationId, userId);
                    }
                });

                // إدخال الرسالة باستخدام Enter
                document.addEventListener('keypress', (e) => {
                    if (e.target.classList.contains('message-input') && e.key === 'Enter') {
                        this.sendMessage();
                    }

                    if (e.target.classList.contains('post-textarea') && e.key === 'Enter' && e.ctrlKey) {
                        this.createPost();
                    }
                });

                // البحث عن المستخدمين
                document.addEventListener('input', (e) => {
                    if (e.target.classList.contains('search-input')) {
                        clearTimeout(this.searchTimeout);
                        this.searchTimeout = setTimeout(() => {
                            this.searchUsers(e.target.value);
                        }, 500);
                    }
                });

                // قوة كلمة المرور
                document.addEventListener('input', (e) => {
                    if (e.target.id === 'password') {
                        this.checkPasswordStrength(e.target.value);
                    }
                });
            }

            async loadInitialData() {
                if (this.currentUser) {
                    this.loadFriends();
                    this.loadFriendRequests();
                    this.loadSuggestedFriends();
                }
            }

            async loadFriends() {
                try {
                    // هذا مثال بسيط - في تطبيق حقيقي تحتاج لجلب الأصدقاء من Firebase
                    this.friends = [
                        { id: '2', name: 'أحمد محمد', mutual: 15, profilePicture: '' },
                        { id: '3', name: 'سارة عبدالله', mutual: 8, profilePicture: '' },
                        { id: '4', name: 'محمد الخالد', mutual: 12, profilePicture: '' }
                    ];
                    this.renderFriends();
                } catch (error) {
                    console.error('Error loading friends:', error);
                }
            }

            async loadFriendRequests() {
                try {
                    // هذا مثال بسيط
                    this.friendRequests = [
                        { id: '5', name: 'فاطمة العلي', mutual: 3, profilePicture: '' },
                        { id: '6', name: 'خالد السعد', mutual: 7, profilePicture: '' }
                    ];
                    this.renderFriendRequests();
                } catch (error) {
                    console.error('Error loading friend requests:', error);
                }
            }

            async loadSuggestedFriends() {
                try {
                    // هذا مثال بسيط
                    this.suggestedFriends = [
                        { id: '7', name: 'نورة القحطاني', mutual: 5, profilePicture: '' },
                        { id: '8', name: 'عبدالله الحربي', mutual: 9, profilePicture: '' },
                        { id: '9', name: 'لينا الشمري', mutual: 2, profilePicture: '' }
                    ];
                    this.renderSuggestedFriends();
                } catch (error) {
                    console.error('Error loading suggested friends:', error);
                }
            }

            toggleLoginSignup() {
                const loginTitle = document.getElementById('loginTitle');
                const loginBtn = document.querySelector('.login-btn');
                const signupBtn = document.querySelector('.signup-btn');
                const nameField = document.getElementById('nameField');
                const bioField = document.getElementById('bioField');

                if (loginTitle.textContent.includes('تسجيل الدخول')) {
                    loginTitle.textContent = 'إنشاء حساب جديد';
                    loginBtn.classList.add('hidden');
                    signupBtn.classList.remove('hidden');
                    nameField.classList.remove('hidden');
                    bioField.classList.remove('hidden');
                } else {
                    loginTitle.textContent = 'تسجيل الدخول';
                    loginBtn.classList.remove('hidden');
                    signupBtn.classList.add('hidden');
                    nameField.classList.add('hidden');
                    bioField.classList.add('hidden');
                }
            }

            checkPasswordStrength(password) {
                const strengthBar = document.getElementById('passwordStrength');
                if (!strengthBar) return;

                let strength = 0;
                if (password.length >= 8) strength += 1;
                if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength += 1;
                if (password.match(/\d/)) strength += 1;
                if (password.match(/[^a-zA-Z\d]/)) strength += 1;

                strengthBar.className = 'strength-bar';
                if (password.length === 0) {
                    strengthBar.style.width = '0%';
                } else if (strength === 1) {
                    strengthBar.classList.add('strength-weak');
                } else if (strength === 2 || strength === 3) {
                    strengthBar.classList.add('strength-medium');
                } else if (strength === 4) {
                    strengthBar.classList.add('strength-strong');
                }
            }

            async handleLogin() {
                if (this.isLoading) return;

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (!email || !password) {
                    this.showError('يرجى ملء جميع الحقول');
                    return;
                }

                this.setLoading(true);
                
                try {
                    await window.firebaseFunctions.signInWithEmailAndPassword(
                        window.firebase.auth, email, password
                    );
                    this.showSuccess('تم تسجيل الدخول بنجاح!');
                } catch (error) {
                    console.error('Login error:', error);
                    this.showError(this.getErrorMessage(error.code));
                } finally {
                    this.setLoading(false);
                }
            }

            async handleSignup() {
                if (this.isLoading) return;

                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const bio = document.getElementById('bio').value || 'مرحباً! أنا جديد في Social';

                if (!name || !email || !password) {
                    this.showError('يرجى ملء جميع الحقول');
                    return;
                }

                if (password.length < 8) {
                    this.showError('كلمة المرور يجب أن تكون 8 أحرف على الأقل');
                    return;
                }

                this.setLoading(true);

                try {
                    // إنشاء المستخدم في Authentication
                    const result = await window.firebaseFunctions.createUserWithEmailAndPassword(
                        window.firebase.auth, email, password
                    );
                    
                    console.log('User created in auth:', result.user.uid);

                    // تحديث الاسم في Authentication
                    await window.firebaseFunctions.updateProfile(result.user, {
                        displayName: name
                    });
                    
                    console.log('Profile updated');

                    // إنشاء مستند المستخدم في Firestore
                    await this.createUserDocument(result.user);
                    
                    console.log('User document created in firestore');
                    
                    this.showSuccess('تم إنشاء الحساب بنجاح!');
                } catch (error) {
                    console.error('Signup error details:', error);
                    console.error('Error code:', error.code);
                    console.error('Error message:', error.message);
                    this.showError(this.getErrorMessage(error.code));
                } finally {
                    this.setLoading(false);
                }
            }

            getErrorMessage(errorCode) {
                const messages = {
                    'auth/email-already-in-use': 'البريد الإلكتروني مستخدم بالفعل',
                    'auth/invalid-email': 'بريد إلكتروني غير صالح',
                    'auth/weak-password': 'كلمة المرور ضعيفة (8 أحرف على الأقل)',
                    'auth/user-not-found': 'لم يتم العثور على المستخدم',
                    'auth/wrong-password': 'كلمة المرور خاطئة',
                    'auth/too-many-requests': 'محاولات كثيرة، يرجى المحاولة لاحقاً',
                    'auth/network-request-failed': 'خطأ في الاتصال بالإنترنت',
                    'auth/operation-not-allowed': 'عملية غير مسموحة',
                    'permission-denied': 'غير مصرح لك بهذا الإجراء'
                };
                return messages[errorCode] || `حدث خطأ غير متوقع: ${errorCode}`;
            }

            async handleLogout() {
                try {
                    await window.firebaseFunctions.signOut(window.firebase.auth);
                    this.showSuccess('تم تسجيل الخروج بنجاح');
                } catch (error) {
                    console.error('Error signing out:', error);
                    this.showError('خطأ في تسجيل الخروج');
                }
            }

            setLoading(loading) {
                this.isLoading = loading;
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach(btn => {
                    if (loading) {
                        btn.disabled = true;
                        btn.classList.add('loading');
                    } else {
                        btn.disabled = false;
                        btn.classList.remove('loading');
                    }
                });
            }

            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                document.body.classList.toggle('dark-mode', this.isDarkMode);
                localStorage.setItem('darkMode', this.isDarkMode);
            }

            showLogin() {
                document.getElementById('app').innerHTML = `
                    <div class="auth-container">
                        <div class="auth-box">
                            <div class="auth-header">
                                <div class="auth-logo">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h1 class="auth-title" id="loginTitle">تسجيل الدخول</h1>
                                <p class="auth-subtitle">مرحباً بعودتك! سجل الدخول إلى حسابك</p>
                            </div>
                            
                            <div id="messageContainer"></div>
                            
                            <form class="auth-form">
                                <div class="form-group hidden" id="nameField">
                                    <label class="form-label" for="name">الاسم الكامل</label>
                                    <input type="text" id="name" class="form-input" placeholder="أدخل اسمك الكامل" required>
                                </div>
                                
                                <div class="form-group hidden" id="bioField">
                                    <label class="form-label" for="bio">نبذة عنك</label>
                                    <input type="text" id="bio" class="form-input" placeholder="اكتب نبذة مختصرة عنك">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="email">البريد الإلكتروني</label>
                                    <input type="email" id="email" class="form-input" placeholder="أدخل بريدك الإلكتروني" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="password">كلمة المرور</label>
                                    <input type="password" id="password" class="form-input" placeholder="أدخل كلمة المرور" required minlength="8">
                                    <div class="password-strength">
                                        <div class="strength-bar" id="passwordStrength"></div>
                                    </div>
                                </div>
                                
                                <button type="button" class="btn login-btn">
                                    <i class="fas fa-sign-in-alt"></i>
                                    تسجيل الدخول
                                </button>
                                <button type="button" class="btn btn-secondary signup-btn hidden">
                                    <i class="fas fa-user-plus"></i>
                                    إنشاء حساب
                                </button>
                            </form>
                            
                            <div class="auth-switch">
                                <span class="auth-link">ليس لديك حساب؟ أنشئ حساب جديد</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            showApp() {
                document.getElementById('app').innerHTML = `
                    <div class="app-container">
                        <header class="header">
                            <div class="header-logo">
                                <i class="fas fa-users"></i>
                                <span>Social</span>
                            </div>
                            
                            <nav class="header-nav">
                                <div class="nav-item ${this.currentPage === 'home' ? 'active' : ''}" data-page="home">
                                    <i class="fas fa-home"></i>
                                    <span>الرئيسية</span>
                                </div>
                                <div class="nav-item ${this.currentPage === 'friends' ? 'active' : ''}" data-page="friends">
                                    <i class="fas fa-user-friends"></i>
                                    <span>الأصدقاء</span>
                                </div>
                                <div class="nav-item ${this.currentPage === 'messages' ? 'active' : ''}" data-page="messages">
                                    <i class="fas fa-comments"></i>
                                    <span>الرسائل</span>
                                </div>
                                <div class="nav-item ${this.currentPage === 'profile' ? 'active' : ''}" data-page="profile">
                                    <i class="fas fa-user"></i>
                                    <span>الملف الشخصي</span>
                                </div>
                            </nav>
                            
                            <div class="header-actions">
                                <button class="theme-toggle">
                                    <i class="fas ${this.isDarkMode ? 'fa-sun' : 'fa-moon'}"></i>
                                </button>
                                
                                <div class="user-menu">
                                    <div class="user-avatar">
                                        ${this.currentUser?.profilePicture ? 
                                            `<img src="${this.currentUser.profilePicture}" alt="${this.currentUser.name}">` : 
                                            this.currentUser?.name?.charAt(0) || '?'
                                        }
                                    </div>
                                    <span>${this.currentUser?.name || 'مستخدم'}</span>
                                    <button class="btn logout-btn">تسجيل الخروج</button>
                                </div>
                            </div>
                        </header>

                        <div class="main-content">
                            <aside class="sidebar">
                                <div class="sidebar-section">
                                    <h3 class="sidebar-title">
                                        <i class="fas fa-compass"></i>
                                        التنقل
                                    </h3>
                                    <div class="sidebar-item ${this.currentPage === 'home' ? 'active' : ''}" data-page="home">
                                        <i class="fas fa-home"></i>
                                        <span>الصفحة الرئيسية</span>
                                    </div>
                                    <div class="sidebar-item ${this.currentPage === 'friends' ? 'active' : ''}" data-page="friends">
                                        <i class="fas fa-user-friends"></i>
                                        <span>الأصدقاء</span>
                                    </div>
                                    <div class="sidebar-item ${this.currentPage === 'messages' ? 'active' : ''}" data-page="messages">
                                        <i class="fas fa-comments"></i>
                                        <span>الرسائل</span>
                                    </div>
                                    <div class="sidebar-item ${this.currentPage === 'profile' ? 'active' : ''}" data-page="profile">
                                        <i class="fas fa-user"></i>
                                        <span>الملف الشخصي</span>
                                    </div>
                                </div>
                                
                                <div class="sidebar-section">
                                    <h3 class="sidebar-title">
                                        <i class="fas fa-user-plus"></i>
                                        اقتراحات أصدقاء
                                    </h3>
                                    ${this.suggestedFriends.slice(0, 3).map(friend => `
                                        <div class="sidebar-item">
                                            <div class="user-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">
                                                ${friend.profilePicture ? 
                                                    `<img src="${friend.profilePicture}" alt="${friend.name}">` : 
                                                    friend.name.charAt(0)
                                                }
                                            </div>
                                            <span>${friend.name}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </aside>

                            <main class="content-area">
                                ${this.renderCurrentPage()}
                            </main>
                        </div>
                    </div>
                `;

                // تحميل البيانات الخاصة بكل صفحة
                if (this.currentPage === 'messages') {
                    this.loadConversations();
                } else if (this.currentPage === 'friends') {
                    this.renderFriendsPage();
                } else if (this.currentPage === 'profile') {
                    this.renderProfilePage();
                }
            }

            renderCurrentPage() {
                switch (this.currentPage) {
                    case 'home':
                        return this.renderHome();
                    case 'friends':
                        return this.renderFriendsPage();
                    case 'messages':
                        return this.renderMessages();
                    case 'profile':
                        return this.renderProfilePage();
                    default:
                        return this.renderHome();
                }
            }

            renderHome() {
                return `
                    <div class="page">
                        <div class="create-post">
                            <div class="post-input">
                                <div class="post-avatar">
                                    ${this.currentUser?.profilePicture ? 
                                        `<img src="${this.currentUser.profilePicture}" alt="${this.currentUser.name}">` : 
                                        this.currentUser?.name?.charAt(0) || '?'
                                    }
                                </div>
                                <div class="post-editor">
                                    <textarea class="post-textarea" placeholder="ماذا يدور في ذهنك؟"></textarea>
                                    <div class="post-actions">
                                        <div class="post-options">
                                            <div class="post-option">
                                                <i class="fas fa-image"></i>
                                                صورة
                                            </div>
                                            <div class="post-option">
                                                <i class="fas fa-video"></i>
                                                فيديو
                                            </div>
                                            <div class="post-option">
                                                <i class="fas fa-map-marker-alt"></i>
                                                موقع
                                            </div>
                                        </div>
                                        <button class="btn">نشر</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feed">
                            <div class="post">
                                <div class="post-header">
                                    <div class="post-avatar">
                                        <img src="https://via.placeholder.com/50" alt="أحمد محمد">
                                    </div>
                                    <div class="post-user">
                                        <div class="post-name">أحمد محمد</div>
                                        <div class="post-time">منذ ساعتين</div>
                                    </div>
                                </div>
                                <div class="post-content">
                                    هذا التطبيق رائع! التصميم جميل جداً والميزات متكاملة. أنصح الجميع بتجربته! 🚀
                                </div>
                                <div class="post-stats">
                                    <span>١٥٠ إعجاب</span>
                                    <span>٢٣ تعليق</span>
                                    <span>٥ مشاركات</span>
                                </div>
                                <div class="post-engagement">
                                    <div class="post-action">
                                        <i class="fas fa-thumbs-up"></i>
                                        إعجاب
                                    </div>
                                    <div class="post-action">
                                        <i class="fas fa-comment"></i>
                                        تعليق
                                    </div>
                                    <div class="post-action">
                                        <i class="fas fa-share"></i>
                                        مشاركة
                                    </div>
                                </div>
                            </div>
                            
                            <div class="post">
                                <div class="post-header">
                                    <div class="post-avatar">
                                        <img src="https://via.placeholder.com/50" alt="سارة عبدالله">
                                    </div>
                                    <div class="post-user">
                                        <div class="post-name">سارة عبدالله</div>
                                        <div class="post-time">منذ ٥ ساعات</div>
                                    </div>
                                </div>
                                <div class="post-content">
                                    أجمل شيء في هذا التطبيق هو سهولة التواصل مع الأصدقاء ونظام الرسائل المميز. أنا سعيدة جداً باستخدامه! 💫
                                </div>
                                <div class="post-image">
                                    <img src="https://via.placeholder.com/600x300" alt="صورة المنشور">
                                </div>
                                <div class="post-stats">
                                    <span>٨٩ إعجاب</span>
                                    <span>١٤ تعليق</span>
                                    <span>٣ مشاركات</span>
                                </div>
                                <div class="post-engagement">
                                    <div class="post-action">
                                        <i class="fas fa-thumbs-up"></i>
                                        إعجاب
                                    </div>
                                    <div class="post-action">
                                        <i class="fas fa-comment"></i>
                                        تعليق
                                    </div>
                                    <div class="post-action">
                                        <i class="fas fa-share"></i>
                                        مشاركة
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderFriendsPage() {
                return `
                    <div class="page friends-page">
                        <div class="page-header">
                            <h2 class="page-title">الأصدقاء</h2>
                            <div class="page-actions">
                                <button class="btn">
                                    <i class="fas fa-user-plus"></i>
                                    إضافة صديق
                                </button>
                            </div>
                        </div>
                        
                        <div class="friends-search">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" placeholder="ابحث عن أصدقاء...">
                            </div>
                        </div>
                        
                        <div class="friends-tabs">
                            <div class="friend-tab active" data-tab="all">جميع الأصدقاء</div>
                            <div class="friend-tab" data-tab="requests">طلبات الصداقة</div>
                            <div class="friend-tab" data-tab="suggestions">اقتراحات</div>
                        </div>
                        
                        <div class="friends-list" id="friendsList">
                            <!-- سيتم تحميل الأصدقاء هنا -->
                        </div>
                    </div>
                `;
            }

            renderMessages() {
                return `
                    <div class="page messages-page">
                        <div class="messages-container">
                            <div class="conversations-sidebar">
                                <div class="conversations-header">
                                    <h3>المحادثات</h3>
                                    <button class="btn new-conversation-btn">محادثة جديدة</button>
                                </div>
                                <div class="conversations-list" id="conversationsList">
                                    <!-- سيتم تحميل المحادثات هنا -->
                                </div>
                            </div>
                            <div class="chat-area" id="chatArea">
                                <div class="empty-chat">
                                    <div class="empty-chat-icon">💬</div>
                                    <h3>اختر محادثة لبدء الدردشة</h3>
                                    <p>اختر من قائمة المحادثات أو ابدأ محادثة جديدة</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderProfilePage() {
                return `
                    <div class="page profile-page">
                        <div class="profile-header">
                            <div class="profile-avatar">
                                <div class="profile-image">
                                    ${this.currentUser?.profilePicture ? 
                                        `<img src="${this.currentUser.profilePicture}" alt="${this.currentUser.name}">` : 
                                        this.currentUser?.name?.charAt(0) || '?'
                                    }
                                </div>
                                <button class="avatar-edit">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                            
                            <div class="profile-info">
                                <h1 class="profile-name">${this.currentUser?.name || 'مستخدم'}</h1>
                                <p class="profile-bio">${this.currentUser?.bio || 'مرحباً! أنا جديد في Social'}</p>
                                
                                <div class="profile-stats">
                                    <div class="stat">
                                        <div class="stat-value">${this.friends.length}</div>
                                        <div class="stat-label">الأصدقاء</div>
                                    </div>
                                    <div class="stat">
                                        <div class="stat-value">24</div>
                                        <div class="stat-label">المتابعون</div>
                                    </div>
                                    <div class="stat">
                                        <div class="stat-value">156</div>
                                        <div class="stat-label">الإعجابات</div>
                                    </div>
                                </div>
                                
                                <div class="profile-actions">
                                    <button class="btn">
                                        <i class="fas fa-edit"></i>
                                        تعديل الملف
                                    </button>
                                    <button class="btn btn-outline">
                                        <i class="fas fa-share-alt"></i>
                                        مشاركة
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-tabs">
                            <div class="profile-tab active" data-tab="posts">المنشورات</div>
                            <div class="profile-tab" data-tab="about">معلومات</div>
                            <div class="profile-tab" data-tab="friends">الأصدقاء</div>
                            <div class="profile-tab" data-tab="photos">الصور</div>
                        </div>
                        
                        <div class="profile-content">
                            <div class="profile-posts">
                                <div class="post">
                                    <div class="post-header">
                                        <div class="post-avatar">
                                            ${this.currentUser?.profilePicture ? 
                                                `<img src="${this.currentUser.profilePicture}" alt="${this.currentUser.name}">` : 
                                                this.currentUser?.name?.charAt(0) || '?'
                                            }
                                        </div>
                                        <div class="post-user">
                                            <div class="post-name">${this.currentUser?.name || 'مستخدم'}</div>
                                            <div class="post-time">منذ يومين</div>
                                        </div>
                                    </div>
                                    <div class="post-content">
                                        سعيد جداً بانضمامي إلى هذا التطبيق الرائع! التصميم جميل والميزات متكاملة. أنصح الجميع بتجربته! 🌟
                                    </div>
                                    <div class="post-stats">
                                        <span>٤٥ إعجاب</span>
                                        <span>١٢ تعليق</span>
                                        <span>٣ مشاركات</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-details">
                                <div class="detail-item">
                                    <div class="detail-label">البريد الإلكتروني</div>
                                    <div class="detail-value">${this.currentUser?.email || ''}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">تاريخ الانضمام</div>
                                    <div class="detail-value">${new Date().toLocaleDateString('ar-EG')}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">اللغة</div>
                                    <div class="detail-value">العربية</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">الموقع</div>
                                    <div class="detail-value">لم يتم تحديده</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            changePage(page) {
                this.currentPage = page;
                this.showApp();
            }

            changeFriendTab(tab) {
                const tabs = document.querySelectorAll('.friend-tab');
                tabs.forEach(t => t.classList.remove('active'));
                event.target.classList.add('active');
                
                if (tab === 'all') {
                    this.renderFriends();
                } else if (tab === 'requests') {
                    this.renderFriendRequests();
                } else if (tab === 'suggestions') {
                    this.renderSuggestedFriends();
                }
            }

            changeProfileTab(tab) {
                const tabs = document.querySelectorAll('.profile-tab');
                tabs.forEach(t => t.classList.remove('active'));
                event.target.classList.add('active');
                // يمكنك إضافة منطق لعرض محتوى مختلف لكل تبويب
            }

            renderFriends() {
                const container = document.getElementById('friendsList');
                if (!container) return;

                if (this.friends.length === 0) {
                    container.innerHTML = '<div style="padding: 3rem; text-align: center; color: var(--text-secondary);">لا توجد أصدقاء بعد</div>';
                    return;
                }

                container.innerHTML = this.friends.map(friend => `
                    <div class="friend-item">
                        <div class="friend-avatar">
                            ${friend.profilePicture ? 
                                `<img src="${friend.profilePicture}" alt="${friend.name}">` : 
                                friend.name.charAt(0)
                            }
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.name}</div>
                            <div class="friend-mutual">${friend.mutual} صديق مشترك</div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn">
                                <i class="fas fa-comment"></i>
                                رسالة
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            renderFriendRequests() {
                const container = document.getElementById('friendsList');
                if (!container) return;

                if (this.friendRequests.length === 0) {
                    container.innerHTML = '<div style="padding: 3rem; text-align: center; color: var(--text-secondary);">لا توجد طلبات صداقة</div>';
                    return;
                }

                container.innerHTML = this.friendRequests.map(friend => `
                    <div class="friend-item">
                        <div class="friend-avatar">
                            ${friend.profilePicture ? 
                                `<img src="${friend.profilePicture}" alt="${friend.name}">` : 
                                friend.name.charAt(0)
                            }
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.name}</div>
                            <div class="friend-mutual">${friend.mutual} صديق مشترك</div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn accept-friend-btn" data-user-id="${friend.id}">
                                <i class="fas fa-check"></i>
                                قبول
                            </button>
                            <button class="btn btn-outline">
                                <i class="fas fa-times"></i>
                                رفض
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            renderSuggestedFriends() {
                const container = document.getElementById('friendsList');
                if (!container) return;

                if (this.suggestedFriends.length === 0) {
                    container.innerHTML = '<div style="padding: 3rem; text-align: center; color: var(--text-secondary);">لا توجد اقتراحات</div>';
                    return;
                }

                container.innerHTML = this.suggestedFriends.map(friend => `
                    <div class="friend-item">
                        <div class="friend-avatar">
                            ${friend.profilePicture ? 
                                `<img src="${friend.profilePicture}" alt="${friend.name}">` : 
                                friend.name.charAt(0)
                            }
                        </div>
                        <div class="friend-info">
                            <div class="friend-name">${friend.name}</div>
                            <div class="friend-mutual">${friend.mutual} صديق مشترك</div>
                        </div>
                        <div class="friend-actions">
                            <button class="btn add-friend-btn" data-user-id="${friend.id}">
                                <i class="fas fa-user-plus"></i>
                                إضافة
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            async sendFriendRequest(userId) {
                try {
                    // في تطبيق حقيقي، هنا سيتم إرسال طلب الصداقة إلى Firebase
                    this.showSuccess('تم إرسال طلب الصداقة');
                } catch (error) {
                    console.error('Error sending friend request:', error);
                    this.showError('فشل في إرسال طلب الصداقة');
                }
            }

            async acceptFriendRequest(userId) {
                try {
                    // في تطبيق حقيقي، هنا سيتم قبول طلب الصداقة في Firebase
                    this.showSuccess('تم قبول طلب الصداقة');
                } catch (error) {
                    console.error('Error accepting friend request:', error);
                    this.showError('فشل في قبول طلب الصداقة');
                }
            }

            async uploadProfilePicture() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        try {
                            this.setLoading(true);
                            // في تطبيق حقيقي، هنا سيتم رفع الصورة إلى Firebase Storage
                            // وتحديث رابط الصورة في Firestore
                            this.showSuccess('تم تحديث صورة الملف الشخصي');
                        } catch (error) {
                            console.error('Error uploading profile picture:', error);
                            this.showError('فشل في تحديث صورة الملف الشخصي');
                        } finally {
                            this.setLoading(false);
                        }
                    }
                };
                input.click();
            }

            showError(message) {
                const container = document.getElementById('messageContainer');
                if (container) {
                    container.innerHTML = `<div class="error-message">${message}</div>`;
                    setTimeout(() => {
                        if (container.innerHTML.includes('error-message')) {
                            container.innerHTML = '';
                        }
                    }, 5000);
                } else {
                    // إذا لم يكن هناك container، نعرض alert مؤقت
                    alert(`خطأ: ${message}`);
                }
            }

            showSuccess(message) {
                const container = document.getElementById('messageContainer');
                if (container) {
                    container.innerHTML = `<div class="success-message">${message}</div>`;
                    setTimeout(() => {
                        if (container.innerHTML.includes('success-message')) {
                            container.innerHTML = '';
                        }
                    }, 3000);
                }
            }

            // نظام الرسائل
            async loadConversations() {
                try {
                    // هذا مثال بسيط - في تطبيق حقيقي سيتم جلب المحادثات من Firebase
                    this.conversations = [
                        { id: '1', participants: ['1', '2'], lastMessage: 'مرحباً! كيف حالك؟', lastMessageTime: new Date(), user: { id: '2', name: 'أحمد محمد' } },
                        { id: '2', participants: ['1', '3'], lastMessage: 'شكراً على المساعدة', lastMessageTime: new Date(Date.now() - 3600000), user: { id: '3', name: 'سارة عبدالله' } }
                    ];
                    this.renderConversations();
                } catch (error) {
                    console.error('Error loading conversations:', error);
                }
            }

            renderConversations() {
                const container = document.getElementById('conversationsList');
                if (!container) return;

                if (this.conversations.length === 0) {
                    container.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-secondary);">لا توجد محادثات</div>';
                    return;
                }

                container.innerHTML = this.conversations.map(convo => {
                    return `
                        <div class="conversation-item" data-conversation-id="${convo.id}" data-user-id="${convo.user.id}">
                            <div class="conversation-avatar">
                                ${convo.user.profilePicture ? 
                                    `<img src="${convo.user.profilePicture}" alt="${convo.user.name}">` : 
                                    convo.user.name.charAt(0)
                                }
                            </div>
                            <div class="conversation-info">
                                <div class="conversation-name">${convo.user.name}</div>
                                <div class="conversation-last-message">${convo.lastMessage}</div>
                            </div>
                            <div class="conversation-time">
                                ${this.formatTime(convo.lastMessageTime)}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            async openConversation(conversationId, otherUserId) {
                this.currentConversation = conversationId;
                
                // جلب بيانات المستخدم الآخر إذا لم تكن موجودة
                if (!this.users[otherUserId]) {
                    try {
                        // في تطبيق حقيقي، هنا سيتم جلب بيانات المستخدم من Firebase
                        this.users[otherUserId] = { id: otherUserId, name: 'مستخدم' };
                    } catch (error) {
                        console.error('Error loading user:', error);
                        this.users[otherUserId] = { name: 'مستخدم', id: otherUserId };
                    }
                }

                this.renderChatWindow(otherUserId);
                this.loadMessages(conversationId);
            }

            renderChatWindow(otherUserId) {
                const otherUser = this.users[otherUserId] || { name: 'مستخدم' };
                
                document.getElementById('chatArea').innerHTML = `
                    <div class="chat-area">
                        <div class="chat-header">
                            <div class="chat-user-avatar">
                                ${otherUser.profilePicture ? 
                                    `<img src="${otherUser.profilePicture}" alt="${otherUser.name}">` : 
                                    otherUser.name.charAt(0)
                                }
                            </div>
                            <div class="chat-user-info">
                                <div class="chat-user-name">${otherUser.name}</div>
                                <div class="chat-user-status">متصل الآن</div>
                            </div>
                        </div>
                        <div class="messages-container-inner" id="messagesContainer">
                            <!-- سيتم تحميل الرسائل هنا -->
                        </div>
                        <div class="message-input-area">
                            <input type="text" class="message-input" placeholder="اكتب رسالة...">
                            <button class="send-button">
                                <i class="fas fa-paper-plane"></i>
                                إرسال
                            </button>
                        </div>
                    </div>
                `;
            }

            loadMessages(conversationId) {
                // هذا مثال بسيط - في تطبيق حقيقي سيتم جلب الرسائل من Firebase
                this.messages = [
                    { id: '1', senderId: '2', text: 'مرحباً! كيف حالك؟', timestamp: new Date(Date.now() - 300000) },
                    { id: '2', senderId: '1', text: 'أهلاً! أنا بخير، شكراً لك. كيف حالك أنت؟', timestamp: new Date(Date.now() - 240000) },
                    { id: '3', senderId: '2', text: 'أنا أيضاً بخير، شكراً. هل رأيت التحديثات الجديدة في التطبيق؟', timestamp: new Date(Date.now() - 180000) },
                    { id: '4', senderId: '1', text: 'نعم، التصميم الجديد رائع! أحببت especialmente نظام الأصدقاء الجديد', timestamp: new Date(Date.now() - 120000) }
                ];
                this.renderMessages();
            }

            renderMessages() {
                const container = document.getElementById('messagesContainer');
                if (!container) return;

                container.innerHTML = this.messages.map(message => {
                    const isSent = message.senderId === this.currentUser.uid;
                    return `
                        <div class="message ${isSent ? 'sent' : 'received'}">
                            <div class="message-content">
                                <div class="message-text">${message.text}</div>
                                <div class="message-time">
                                    ${this.formatTime(message.timestamp)}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // التمرير للأسفل
                container.scrollTop = container.scrollHeight;
            }

            async sendMessage() {
                const input = document.querySelector('.message-input');
                const text = input?.value.trim();

                if (!text || !this.currentConversation) return;

                try {
                    // في تطبيق حقيقي، هنا سيتم إرسال الرسالة إلى Firebase
                    this.messages.push({
                        id: Date.now().toString(),
                        senderId: this.currentUser.uid,
                        text: text,
                        timestamp: new Date()
                    });
                    
                    this.renderMessages();
                    input.value = '';
                } catch (error) {
                    console.error('Error sending message:', error);
                    this.showError('فشل في إرسال الرسالة');
                }
            }

            showNewConversation() {
                document.getElementById('chatArea').innerHTML = `
                    <div class="new-conversation">
                        <div class="new-conversation-header">
                            <button class="back-button">← رجوع</button>
                            <h3>بدء محادثة جديدة</h3>
                        </div>
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="ابحث عن مستخدم..." id="userSearch">
                        </div>
                        <div class="search-results" id="searchResults">
                            <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                ابدأ بالكتابة للبحث عن مستخدمين
                            </div>
                        </div>
                    </div>
                `;
            }

            async searchUsers(searchTerm) {
                if (!searchTerm || searchTerm.length < 2) {
                    document.getElementById('searchResults').innerHTML = 
                        '<div style="padding: 2rem; text-align: center; color: var(--text-secondary);">اكتب حرفين على الأقل للبحث</div>';
                    return;
                }

                try {
                    // في تطبيق حقيقي، هنا سيتم البحث عن المستخدمين في Firebase
                    const users = [
                        { id: '2', name: 'أحمد محمد', email: 'ahmed@example.com' },
                        { id: '3', name: 'سارة عبدالله', email: 'sara@example.com' },
                        { id: '4', name: 'محمد الخالد', email: 'mohammed@example.com' }
                    ].filter(user => 
                        user.name.includes(searchTerm) || user.email.includes(searchTerm)
                    );

                    this.renderSearchResults(users);
                } catch (error) {
                    console.error('Error searching users:', error);
                    document.getElementById('searchResults').innerHTML = 
                        '<div class="error-message">فشل في البحث عن المستخدمين</div>';
                }
            }

            renderSearchResults(users) {
                const container = document.getElementById('searchResults');
                
                if (users.length === 0) {
                    container.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-secondary);">لا توجد نتائج</div>';
                    return;
                }

                container.innerHTML = users.map(user => `
                    <div class="user-result" data-user-id="${user.id}">
                        <div class="user-avatar">
                            ${user.profilePicture ? 
                                `<img src="${user.profilePicture}" alt="${user.name}">` : 
                                user.name.charAt(0)
                            }
                        </div>
                        <div class="user-info">
                            <div class="user-name">${user.name}</div>
                            <div class="user-email">${user.email}</div>
                        </div>
                    </div>
                `).join('');
            }

            async startConversation(otherUserId) {
                try {
                    // التحقق إذا كانت هناك محادثة موجودة مسبقاً
                    const existingConvo = this.conversations.find(convo => 
                        convo.participants.includes(otherUserId)
                    );

                    if (existingConvo) {
                        this.openConversation(existingConvo.id, otherUserId);
                        return;
                    }

                    // إنشاء محادثة جديدة
                    const conversationId = 'new-' + Date.now();
                    this.conversations.unshift({
                        id: conversationId,
                        participants: [this.currentUser.uid, otherUserId],
                        lastMessage: 'بدء المحادثة',
                        lastMessageTime: new Date(),
                        user: this.users[otherUserId] || { id: otherUserId, name: 'مستخدم' }
                    });

                    this.openConversation(conversationId, otherUserId);
                    this.renderConversations();
                } catch (error) {
                    console.error('Error starting conversation:', error);
                    this.showError('فشل في بدء المحادثة');
                }
            }

            showConversations() {
                this.currentConversation = null;
                this.renderMessages();
            }

            formatTime(date) {
                if (!date) return '';
                
                const now = new Date();
                const diff = now - date;
                
                if (diff < 60000) { // أقل من دقيقة
                    return 'الآن';
                } else if (diff < 3600000) { // أقل من ساعة
                    return Math.floor(diff / 60000) + ' د';
                } else if (diff < 86400000) { // أقل من يوم
                    return Math.floor(diff / 3600000) + ' س';
                } else {
                    return date.toLocaleDateString('ar-EG');
                }
            }

            cleanup() {
                // تنظيف الاشتراكات إذا كانت موجودة
            }
        }

        // بدء التطبيق عندما يتم تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            window.socialApp = new SocialApp();
        });

        // تنظيف عند إغلاق الصفحة
        window.addEventListener('beforeunload', () => {
            if (window.socialApp) {
                window.socialApp.cleanup();
            }
        });
    </script>
</body>
</html>